"use strict";(()=>{var e={};e.id=9326,e.ids=[9326],e.modules={3146:(e,t,s)=>{s.r(t),s.d(t,{config:()=>C,default:()=>N,getServerSideProps:()=>S,getStaticPaths:()=>k,getStaticProps:()=>w,reportWebVitals:()=>P,routeModule:()=>D,unstable_getServerProps:()=>q,unstable_getServerSideProps:()=>M,unstable_getStaticParams:()=>E,unstable_getStaticPaths:()=>A,unstable_getStaticProps:()=>Z});var r={};s.r(r),s.d(r,{default:()=>_});var a=s(7093),l=s(5244),i=s(1323),n=s(7645),d=s(6814),c=s(997),o=s(6689),x=s(775),u=s(5993),m=s(1020),p=s(7218),h=s(4370);let g=(0,h.Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);var y=s(2608),f=s(8453);let b=(0,h.Z)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);var j=s(4676),v=s(5451);let _=()=>{let[e,t]=(0,o.useState)([]),[s,r]=(0,o.useState)([]),[a,l]=(0,o.useState)(!1),[i,n]=(0,o.useState)(null),[d,h]=(0,o.useState)(!0),[_,N]=(0,o.useState)(!1),[w,k]=(0,o.useState)({title:"",message:"",recipient_type:"all",class_filter:"",section_filter:"",individual_emails:"",priority:"medium",scheduled_time:"",send_to_parents:!1});(0,o.useEffect)(()=>{S(),C()},[]);let S=async()=>{try{h(!0);let e=await fetch("/api/email-alerts");if(e.ok){let s=await e.json();t(s)}}catch(e){console.error("Error fetching alerts:",e)}finally{h(!1)}},C=async()=>{try{let e=await fetch("/api/students");if(e.ok){let t=await e.json();r(t)}}catch(e){console.error("Error fetching students:",e)}},P=()=>{let e=[];switch(w.recipient_type){case"all":e=s.map(e=>e.email),w.send_to_parents&&(e=[...e,...s.filter(e=>e.parent_email).map(e=>e.parent_email)]);break;case"class":let t=s.filter(e=>e.class===w.class_filter&&(!w.section_filter||e.section===w.section_filter));e=t.map(e=>e.email),w.send_to_parents&&(e=[...e,...t.filter(e=>e.parent_email).map(e=>e.parent_email)]);break;case"individual":e=w.individual_emails.split(",").map(e=>e.trim()).filter(e=>e)}return[...new Set(e)]},Z=async e=>{e.preventDefault();try{let e=P();if(0===e.length){alert("No recipients found. Please check your selection.");return}let t={title:w.title,message:w.message,recipients:e,recipient_type:w.recipient_type,class_filter:w.class_filter,section_filter:w.section_filter,priority:w.priority,scheduled_time:w.scheduled_time||null,status:w.scheduled_time?"scheduled":"draft"},s=i?`/api/email-alerts?id=${i._id}`:"/api/email-alerts";(await fetch(s,{method:i?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok&&(await S(),M())}catch(e){console.error("Error saving alert:",e)}},A=async e=>{if(confirm("Are you sure you want to send this alert now?"))try{N(!0),(await fetch(`/api/email-alerts/send?id=${e}`,{method:"POST"})).ok?(await S(),alert("Alert sent successfully!")):alert("Failed to send alert. Please try again.")}catch(e){console.error("Error sending alert:",e),alert("Error sending alert. Please try again.")}finally{N(!1)}},E=e=>{n(e),k({title:e.title,message:e.message,recipient_type:e.recipient_type,class_filter:e.class_filter||"",section_filter:e.section_filter||"",individual_emails:"individual"===e.recipient_type?e.recipients.join(", "):"",priority:e.priority,scheduled_time:e.scheduled_time?e.scheduled_time.slice(0,16):"",send_to_parents:!1}),l(!0)},q=async e=>{if(confirm("Are you sure you want to delete this alert?"))try{(await fetch(`/api/email-alerts?id=${e}`,{method:"DELETE"})).ok&&await S()}catch(e){console.error("Error deleting alert:",e)}},M=()=>{k({title:"",message:"",recipient_type:"all",class_filter:"",section_filter:"",individual_emails:"",priority:"medium",scheduled_time:"",send_to_parents:!1}),n(null),l(!1)},D=e=>{switch(e){case"sent":return c.jsx(m.Z,{className:"h-5 w-5 text-green-500"});case"scheduled":return c.jsx(p.Z,{className:"h-5 w-5 text-blue-500"});case"failed":return c.jsx(g,{className:"h-5 w-5 text-red-500"});default:return c.jsx(y.Z,{className:"h-5 w-5 text-gray-500"})}},T=e=>{switch(e){case"sent":return"bg-green-100 text-green-800";case"scheduled":return"bg-blue-100 text-blue-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},$=e=>{switch(e){case"high":return"bg-red-100 text-red-800";case"medium":return"bg-yellow-100 text-yellow-800";default:return"bg-green-100 text-green-800"}};return d?c.jsx(u.Z,{children:c.jsx(x.Z,{children:c.jsx("div",{className:"flex items-center justify-center h-64",children:c.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})})})}):c.jsx(u.Z,{children:c.jsx(x.Z,{children:(0,c.jsxs)("div",{className:"space-y-6",children:[(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsxs)("div",{children:[c.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Email Alerts"}),c.jsx("p",{className:"text-gray-600 mt-2",children:"Send notifications and alerts to students and parents"})]}),(0,c.jsxs)("button",{onClick:()=>l(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center",children:[c.jsx(f.Z,{className:"h-4 w-4 mr-2"}),"Create Alert"]})]}),a&&(0,c.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,c.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[c.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:i?"Edit Alert":"Create New Alert"}),c.jsx("button",{onClick:M,className:"text-gray-500 hover:text-gray-700",children:"\xd7"})]}),(0,c.jsxs)("form",{onSubmit:Z,className:"space-y-4",children:[(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Alert Title *"}),c.jsx("input",{type:"text",value:w.title,onChange:e=>k({...w,title:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g., Exam Schedule Update",required:!0})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Message *"}),c.jsx("textarea",{value:w.message,onChange:e=>k({...w,message:e.target.value}),rows:6,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your message here...",required:!0})]}),(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Recipients *"}),(0,c.jsxs)("select",{value:w.recipient_type,onChange:e=>k({...w,recipient_type:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:[c.jsx("option",{value:"all",children:"All Students"}),c.jsx("option",{value:"class",children:"Specific Class"}),c.jsx("option",{value:"individual",children:"Individual Emails"})]})]}),"class"===w.recipient_type&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Class *"}),(0,c.jsxs)("select",{value:w.class_filter,onChange:e=>k({...w,class_filter:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:[c.jsx("option",{value:"",children:"Select Class"}),["6th","7th","8th","9th","10th"].map(e=>c.jsx("option",{value:e,children:e},e))]})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Section"}),(0,c.jsxs)("select",{value:w.section_filter,onChange:e=>k({...w,section_filter:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[c.jsx("option",{value:"",children:"All Sections"}),["A","B","C","D"].map(e=>c.jsx("option",{value:e,children:e},e))]})]})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Priority"}),(0,c.jsxs)("select",{value:w.priority,onChange:e=>k({...w,priority:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[c.jsx("option",{value:"low",children:"Low"}),c.jsx("option",{value:"medium",children:"Medium"}),c.jsx("option",{value:"high",children:"High"})]})]})]}),"individual"===w.recipient_type&&(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Addresses *"}),c.jsx("textarea",{value:w.individual_emails,onChange:e=>k({...w,individual_emails:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter email addresses separated by commas",required:!0})]}),(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Schedule Time (Optional)"}),c.jsx("input",{type:"datetime-local",value:w.scheduled_time,onChange:e=>k({...w,scheduled_time:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),c.jsx("div",{className:"flex items-end",children:(0,c.jsxs)("div",{className:"flex items-center",children:[c.jsx("input",{type:"checkbox",id:"send_to_parents",checked:w.send_to_parents,onChange:e=>k({...w,send_to_parents:e.target.checked}),className:"mr-2"}),c.jsx("label",{htmlFor:"send_to_parents",className:"text-sm font-medium text-gray-700",children:"Also send to parents"})]})})]}),c.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:(0,c.jsxs)("p",{className:"text-sm text-blue-800",children:[c.jsx("strong",{children:"Recipients Preview:"})," ",P().length," email(s) will be sent"]})}),(0,c.jsxs)("div",{className:"flex space-x-4",children:[c.jsx("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:i?"Update Alert":"Save Alert"}),c.jsx("button",{type:"button",onClick:M,className:"bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400 transition-colors",children:"Cancel"})]})]})]}),c.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:c.jsx("div",{className:"overflow-x-auto",children:(0,c.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[c.jsx("thead",{className:"bg-gray-50",children:(0,c.jsxs)("tr",{children:[c.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Alert Details"}),c.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Recipients"}),c.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Priority"}),c.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),c.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Sent Count"}),c.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),c.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:e.map(e=>(0,c.jsxs)("tr",{className:"hover:bg-gray-50",children:[c.jsx("td",{className:"px-6 py-4",children:(0,c.jsxs)("div",{children:[c.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.title}),c.jsx("div",{className:"text-sm text-gray-500 line-clamp-2",children:e.message}),(0,c.jsxs)("div",{className:"text-xs text-gray-400 mt-1",children:["Created: ",new Date(e.created_at).toLocaleDateString()]})]})}),(0,c.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,c.jsxs)("div",{className:"text-sm text-gray-900",children:["all"===e.recipient_type&&"All Students","class"===e.recipient_type&&`${e.class_filter}${e.section_filter?` - ${e.section_filter}`:""}`,"individual"===e.recipient_type&&"Individual"]}),(0,c.jsxs)("div",{className:"text-sm text-gray-500",children:[e.recipients.length," recipients"]})]}),c.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:c.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${$(e.priority)}`,children:e.priority.toUpperCase()})}),(0,c.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,c.jsxs)("div",{className:"flex items-center",children:[D(e.status),c.jsx("span",{className:`ml-2 inline-flex px-2 py-1 text-xs font-semibold rounded-full ${T(e.status)}`,children:e.status.toUpperCase()})]}),e.sent_at&&(0,c.jsxs)("div",{className:"text-xs text-gray-400 mt-1",children:["Sent: ",new Date(e.sent_at).toLocaleDateString()]})]}),c.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:c.jsx("div",{className:"text-sm text-gray-900",children:e.sent_count})}),c.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,c.jsxs)("div",{className:"flex space-x-2",children:[("draft"===e.status||"scheduled"===e.status)&&c.jsx("button",{onClick:()=>A(e._id),disabled:_,className:"text-green-600 hover:text-green-900 disabled:opacity-50",title:"Send Now",children:c.jsx(b,{className:"h-4 w-4"})}),c.jsx("button",{onClick:()=>E(e),className:"text-blue-600 hover:text-blue-900",title:"Edit",children:c.jsx(j.Z,{className:"h-4 w-4"})}),c.jsx("button",{onClick:()=>q(e._id),className:"text-red-600 hover:text-red-900",title:"Delete",children:c.jsx(v.Z,{className:"h-4 w-4"})})]})})]},e._id))})]})})}),0===e.length&&(0,c.jsxs)("div",{className:"text-center py-12",children:[c.jsx(y.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No alerts found"}),c.jsx("p",{className:"text-gray-600",children:"Create your first email alert to get started."})]})]})})})},N=(0,i.l)(r,"default"),w=(0,i.l)(r,"getStaticProps"),k=(0,i.l)(r,"getStaticPaths"),S=(0,i.l)(r,"getServerSideProps"),C=(0,i.l)(r,"config"),P=(0,i.l)(r,"reportWebVitals"),Z=(0,i.l)(r,"unstable_getStaticProps"),A=(0,i.l)(r,"unstable_getStaticPaths"),E=(0,i.l)(r,"unstable_getStaticParams"),q=(0,i.l)(r,"unstable_getServerProps"),M=(0,i.l)(r,"unstable_getServerSideProps"),D=new a.PagesRouteModule({definition:{kind:l.x.PAGES,page:"/admin/alerts",pathname:"/admin/alerts",bundlePath:"",filename:""},components:{App:d.default,Document:n.default},userland:r})},1020:(e,t,s)=>{s.d(t,{Z:()=>r});let r=(0,s(4370).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},7218:(e,t,s)=>{s.d(t,{Z:()=>r});let r=(0,s(4370).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},8453:(e,t,s)=>{s.d(t,{Z:()=>r});let r=(0,s(4370).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},5451:(e,t,s)=>{s.d(t,{Z:()=>r});let r=(0,s(4370).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},6162:e=>{e.exports=require("stream")},1568:e=>{e.exports=require("zlib")}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[6859,9891,468,5741],()=>s(3146));module.exports=r})();